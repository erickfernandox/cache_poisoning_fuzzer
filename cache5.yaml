id: cache-poisoning-5

info:
  name: Cache Poisoning Detection
  author: erickfernandox
  severity: low
  tags: cache,generic
  metadata:
    max-request: 5

variables:
  cache_key: "{{to_lower(rand_base(6))}}"
  cache_header: "{{to_lower(rand_base(6))}}"

http:
  - raw:
      - |
        GET /?{{cache_key}}=13 HTTP/1.1
        Host: {{Hostname}}
        X-as: {{cache_header}}.xfbg
        X-Ashoka-Site-Country: {{cache_header}}.xfbh
        X-AspNet-Version: {{cache_header}}.xfbi
        x-att-deviceid: {{cache_header}}.xfbj
        x-audience-id: {{cache_header}}.xfbk
        x-auserid: {{cache_header}}.xfbl
        x-ausername: {{cache_header}}.xfbm
        X-auth: {{cache_header}}.xfbn
        X-Auth-Bypass: {{cache_header}}.xfbo
        X-Authcache-Key: {{cache_header}}.xfbp
        X-Authed: {{cache_header}}.xfbq
        x-authenticated: {{cache_header}}.xfbr
        x-authenticated-user: {{cache_header}}.xfbs
        x-authentication: {{cache_header}}.xfbt
        x-authentication-key: {{cache_header}}.xfbu

      - |
        GET /?{{cache_key}}=13 HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'contains(body_2, cache_header)'
